<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Card Builder - Business & ID Cards</title>
<meta name="description" content="Create customized business or ID cards with QR codes containing phone and website details. Personalize with logos, colors, and multilingual support. Download high-resolution PNGs.">
<meta name="keywords" content="business card, ID card, QR code, card builder, customizable cards, multilingual card creator">
<meta name="robots" content="index, follow">
<meta name="author" content="Card Builder Team">
<meta property="og:title" content="Interactive Card Builder - Business & ID Cards">
<meta property="og:description" content="Design and download professional business or ID cards with QR codes containing phone and website details, supporting multiple languages.">
<meta property="og:type" content="website">
<meta property="og:image" content="https://example.com/card-preview.jpg">
<meta property="og:url" content="https://example.com/card-builder">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Interactive Card Builder - Business & ID Cards">
<meta name="twitter:description" content="Design professional business or ID cards with QR codes and download them in high resolution.">
<meta name="twitter:image" content="https://example.com/card-preview.jpg">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Interactive Card Builder",
  "description": "A web tool to create and customize business and ID cards with QR codes containing phone and website details, with multilingual support.",
  "applicationCategory": "Productivity",
  "operatingSystem": "All",
  "browserRequirements": "Modern web browser",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
}
</script>
<style>
body { 
  font-family: 'Segoe UI', Arial, 'Noto Sans', sans-serif; 
  background: #f0f2f5; 
  padding: 20px; 
  direction: ltr;
}
h2 { margin-top: 0; }
.container { display: flex; flex-wrap: wrap; gap: 20px; }
.controls { flex: 1; min-width: 320px; }
.preview { flex: 1; min-width: 350px; }
.card-preview {
  width: 350px; height: 200px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  position: relative; display: flex; padding: 15px; overflow: hidden; margin-bottom: 15px;
  flex-direction: column; background: linear-gradient(135deg, #1e3c72, #2a5298);
  transition: all 0.3s ease;
}
.card-preview.vertical { height: 350px; }
.card-preview.rtl { direction: rtl; }
.info-section { 
  flex: 1; display: flex; flex-direction: column; justify-content: space-evenly; 
  padding: 15px; color: #ffffff;
}
.info-section.rtl { padding-right: 0; padding-left: 15px; }
.logo { 
  width: 50px; height: 50px; border-radius: 50%; object-fit: cover; 
  margin-bottom: 10px; align-self: flex-start;
}
.company-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; word-wrap: break-word; }
.contact-details { font-size: 12px; line-height: 1.6; margin: 5px 0; }
.contact-details p { margin: 3px 0; font-size: 12px; word-wrap: break-word; }
.contact-details h2 { font-size: 16px; margin: 3px 0; }
.qr-section { 
  position: absolute; bottom: 15px; right: 15px; width: 100px; height: 100px; 
  display: flex; justify-content: center; align-items: center;
  background: #ffffff; padding: 5px; border-radius: 5px;
}
.qr-section svg { width: 100%; height: 100%; }
.card-watermark {
  position: absolute; top: 50%; left: 50%; font-size: 50px; color: rgba(0,0,0,0.05);
  transform: translate(-50%, -50%) rotate(-30deg); pointer-events: none; white-space: nowrap; user-select: none;
}
input, select, textarea { 
  width: 100%; margin: 5px 0; padding: 6px; border-radius: 6px; border: 1px solid #ccc; 
  font-family: inherit; 
}
button { 
  padding: 10px; border-radius: 6px; border: none; background: #007bff; color: #fff; 
  cursor: pointer; margin-top: 5px; width: 100%; 
}
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
td, th { border: 1px solid #ccc; padding: 5px; }
#profilePic { 
  width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; display: none; 
}
.gradient-btn { padding: 5px 10px; margin: 2px; border: none; border-radius: 5px; cursor: pointer; }
.cmyk-values { margin-top: 10px; background: #eee; padding: 5px; border-radius: 5px; }
.field-group { margin-bottom: 10px; }
.info-section p::before {
  content: attr(data-label) ": ";
}
#qrInfo {
  font-size: 14px; color: #333; margin-bottom: 10px; padding: 10px;
  background: #fff; border-radius: 5px;
}
.custom-field-container { display: flex; gap: 5px; align-items: center; }
.custom-field-container input { width: 45%; }
</style>
</head>
<body>
<h2 id="title" aria-label="Interactive Card Builder for Business and ID Cards">Interactive Card Builder - Business / ID</h2>
<div class="container">
  <div class="controls" role="region" aria-label="Card customization controls">
    <div class="field-group">
      <label for="language">Language:</label>
      <select id="language" aria-label="Select language for card">
        <option value="en">English</option>
        <option value="ar">Arabic</option>
        <option value="zh">Chinese</option>
        <option value="es">Spanish</option>
        <option value="hi">Hindi</option>
      </select>
    </div>
    <div class="field-group">
      <label id="cardTypeLabel" for="cardType">Card Type:</label>
      <select id="cardType" aria-label="Select card type">
        <option value="business">Business Card</option>
        <option value="id">ID Card</option>
      </select>
    </div>
    <div class="field-group">
      <label id="orientationLabel" for="cardOrientation">Card Orientation:</label>
      <select id="cardOrientation" aria-label="Select card orientation">
        <option value="horizontal">Horizontal</option>
        <option value="vertical">Vertical</option>
      </select>
    </div>
    <div class="field-group">
      <label id="widthLabel" for="cardWidth">Card Width (px):</label>
      <input type="number" id="cardWidth" value="350" min="100" aria-label="Set card width in pixels">
      <label id="heightLabel" for="cardHeight">Card Height (px):</label>
      <input type="number" id="cardHeight" value="200" min="100" aria-label="Set card height in pixels">
    </div>
    <div class="field-group">
      <label id="colorModeLabel" for="colorMode">Color Mode:</label>
      <select id="colorMode" aria-label="Select color mode">
        <option value="RGB">RGB (Screen)</option>
        <option value="CMYK">CMYK (Print)</option>
      </select>
    </div>
    <div class="field-group">
      <label id="bgColorLabel" for="cardColor">Card Background Color:</label>
      <input type="color" id="cardColor" value="#1e3c72" aria-label="Select card background color">
      <label id="textColorLabel" for="textColor">Text Color:</label>
      <input type="color" id="textColor" value="#ffffff" aria-label="Select text color">
    </div>
    <div class="field-group">
      <label id="fontLabel" for="fontStyle">Font Style:</label>
      <select id="fontStyle" aria-label="Select font style">
        <option value="Segoe UI">Segoe UI</option>
        <option value="Arial">Arial</option>
        <option value="Verdana">Verdana</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Courier New">Courier New</option>
        <option value="Noto Sans Arabic">Noto Sans Arabic</option>
        <option value="Noto Sans SC">Noto Sans Chinese</option>
        <option value="Noto Sans Devanagari">Noto Sans Hindi</option>
      </select>
    </div>
    <div class="field-group">
      <label id="logoLabel" for="logoImg">Upload Logo:</label>
      <input type="file" id="logoImg" accept="image/*" aria-label="Upload logo image">
    </div>
    <div class="field-group">
      <label id="photoLabel" for="profileImg">Upload Photo / Logo:</label>
      <input type="file" id="profileImg" accept="image/*" aria-label="Upload profile photo or logo">
    </div>
    <div class="field-group">
      <label id="borderRadiusLabel" for="borderRadius">Border Radius (px):</label>
      <input type="number" id="borderRadius" value="15" min="0" aria-label="Set border radius in pixels">
      <label id="shadowLabel" for="shadowIntensity">Shadow Intensity (0-1):</label>
      <input type="number" id="shadowIntensity" step="0.05" value="0.15" min="0" max="1" aria-label="Set shadow intensity">
    </div>
    <div class="field-group">
      <label id="gradientLabel">Gradient Presets:</label>
      <div>
        <button class="gradient-btn" data-grad="linear-gradient(135deg, #1e3c72, #2a5298)" aria-label="Apply Blue Wave gradient">Blue Wave</button>
        <button class="gradient-btn" data-grad="linear-gradient(to right,#ff9a9e,#fad0c4)" aria-label="Apply Pink gradient">Pink</button>
        <button class="gradient-btn" data-grad="linear-gradient(to right,#a1c4fd,#c2e9fb)" aria-label="Apply Blue gradient">Blue</button>
        <button class="gradient-btn" data-grad="linear-gradient(to right,#fbc2eb,#a6c1ee)" aria-label="Apply Purple gradient">Purple</button>
        <button class="gradient-btn" data-grad="" aria-label="Remove gradient">None</button>
      </div>
      <label id="gradStartLabel" for="gradStart">Gradient Start:</label>
      <input type="color" id="gradStart" value="#1e3c72" aria-label="Select gradient start color">
      <label id="gradEndLabel" for="gradEnd">Gradient End:</label>
      <input type="color" id="gradEnd" value="#2a5298" aria-label="Select gradient end color">
      <button id="applyGrad" aria-label="Apply custom gradient">Apply Gradient</button>
    </div>
    <div class="field-group">
      <label id="bgImageLabel" for="bgImage">Background Image URL (optional):</label>
      <input type="url" id="bgImage" placeholder="Paste image URL here" aria-label="Enter background image URL">
    </div>
    <div class="field-group" id="fieldsContainer"></div>
    <div class="field-group">
      <label>Add Custom Field:</label>
      <div class="custom-field-container">
        <input type="text" id="customFieldLabel" placeholder="Field Name (e.g., LinkedIn)" aria-label="Enter custom field label">
        <input type="text" id="customFieldValue" placeholder="Field Value" aria-label="Enter custom field value">
        <button id="addCustomField" aria-label="Add custom field to card">Add</button>
      </div>
    </div>
    <div class="cmyk-values" id="cmykValues" style="display:none;"></div>
    <button id="generateBtn" aria-label="Generate QR code and preview card">Generate QR & Preview</button>
    <button id="downloadPNGBtn" aria-label="Download card as high-resolution PNG">Download High-Res PNG</button>
  </div>
  <div class="preview" role="region" aria-label="Card preview">
    <p id="qrInfo">The QR code will contain only your phone number and website (business cards) or no information (ID cards).</p>
    <div id="cardPreview" class="card-preview">
      <div class="info-section" id="infoSection">
        <img id="logo" src="" alt="Company or personal logo" class="logo">
        <div class="company-name" id="companyName"></div>
        <div class="contact-details" id="contactDetails"></div>
      </div>
      <div class="qr-section" id="qrContainer">
        <div id="qrcode" style="width:100px;height:100px;"></div>
      </div>
      <div id="watermark" class="card-watermark" style="display:none;">CONFIDENTIAL</div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
let currentSVG = "";
let customFields = { business: {}, id: {} }; // Store custom fields by card type and language

const translations = {
  en: {
    title: "Interactive Card Builder - Business / ID",
    cardTypeLabel: "Card Type:",
    orientationLabel: "Card Orientation:",
    widthLabel: "Card Width (px):",
    heightLabel: "Card Height (px):",
    colorModeLabel: "Color Mode:",
    bgColorLabel: "Card Background Color:",
    textColorLabel: "Text Color:",
    fontLabel: "Font Style:",
    logoLabel: "Upload Logo:",
    photoLabel: "Upload Photo / Logo:",
    borderRadiusLabel: "Border Radius (px):",
    shadowLabel: "Shadow Intensity (0-1):",
    gradientLabel: "Gradient Presets:",
    gradStartLabel: "Gradient Start:",
    gradEndLabel: "Gradient End:",
    bgImageLabel: "Background Image URL (optional):",
    fields: {
      business: ["Name", "Position", "Company", "Email", "Phone", "Website", "Currency"],
      id: ["Name", "ID Number", "Department", "Validity"]
    },
    watermark: "CONFIDENTIAL",
    qrInfo: {
      business: "The QR code contains only your phone number and website.",
      id: "No QR code is generated for ID cards."
    }
  },
  ar: {
    title: "منشئ البطاقات التفاعلية - الأعمال / الهوية",
    cardTypeLabel: "نوع البطاقة:",
    orientationLabel: "اتجاه البطاقة:",
    widthLabel: "عرض البطاقة (بكسل):",
    heightLabel: "ارتفاع البطاقة (بكسل):",
    colorModeLabel: "وضع الألوان:",
    bgColorLabel: "لون خلفية البطاقة:",
    textColorLabel: "لون النص:",
    fontLabel: "نمط الخط:",
    logoLabel: "رفع الشعار:",
    photoLabel: "رفع صورة / شعار:",
    borderRadiusLabel: "نصف قطر الحدود (بكسل):",
    shadowLabel: "شدة الظل (0-1):",
    gradientLabel: "إعدادات التدرج اللوني:",
    gradStartLabel: "بداية التدرج:",
    gradEndLabel: "نهاية التدرج:",
    bgImageLabel: "رابط صورة الخلفية (اختياري):",
    fields: {
      business: ["الاسم", "المنصب", "الشركة", "البريد الإلكتروني", "الهاتف", "الموقع الإلكتروني", "العملة"],
      id: ["الاسم", "رقم الهوية", "القسم", "الصلاحية"]
    },
    watermark: "سري",
    qrInfo: {
      business: "رمز الاستجابة السريعة يحتوي فقط على رقم هاتفك وموقعك الإلكتروني.",
      id: "لا يتم إنشاء رمز الاستجابة السريعة لبطاقات الهوية."
    }
  },
  zh: {
    title: "交互式卡片生成器 - 商务 / 身份",
    cardTypeLabel: "卡片类型:",
    orientationLabel: "卡片方向:",
    widthLabel: "卡片宽度（像素）:",
    heightLabel: "卡片高度（像素）:",
    colorModeLabel: "颜色模式:",
    bgColorLabel: "卡片背景颜色:",
    textColorLabel: "文本颜色:",
    fontLabel: "字体样式:",
    logoLabel: "上传标志:",
    photoLabel: "上传照片/标志:",
    borderRadiusLabel: "边框半径（像素）:",
    shadowLabel: "阴影强度（0-1):",
    gradientLabel: "渐变预设:",
    gradStartLabel: "渐变起点:",
    gradEndLabel: "渐变终点:",
    bgImageLabel: "背景图片URL（可选）:",
    fields: {
      business: ["姓名", "职位", "公司", "电子邮件", "电话", "网站", "货币"],
      id: ["姓名", "身份证号", "部门", "有效期"]
    },
    watermark: "机密",
    qrInfo: {
      business: "二维码仅包含您的电话号码和网站。",
      id: "身份证不生成二维码。"
    }
  },
  es: {
    title: "Creador de Tarjetas Interactivas - Negocios / Identificación",
    cardTypeLabel: "Tipo de Tarjeta:",
    orientationLabel: "Orientación de la Tarjeta:",
    widthLabel: "Ancho de la Tarjeta (px):",
    heightLabel: "Alto de la Tarjeta (px):",
    colorModeLabel: "Modo de Color:",
    bgColorLabel: "Color de Fondo de la Tarjeta:",
    textColorLabel: "Color del Texto:",
    fontLabel: "Estilo de Fuente:",
    logoLabel: "Subir Logotipo:",
    photoLabel: "Subir Foto / Logotipo:",
    borderRadiusLabel: "Radio del Borde (px):",
    shadowLabel: "Intensidad de la Sombra (0-1):",
    gradientLabel: "Preajustes de Gradiente:",
    gradStartLabel: "Inicio del Gradiente:",
    gradEndLabel: "Fin del Gradiente:",
    bgImageLabel: "URL de Imagen de Fondo (opcional):",
    fields: {
      business: ["Nombre", "Puesto", "Compañía", "Correo Electrónico", "Teléfono", "Sitio Web", "Moneda"],
      id: ["Nombre", "Número de Identificación", "Departamento", "Validez"]
    },
    watermark: "CONFIDENCIAL",
    qrInfo: {
      business: "El código QR contiene solo su número de teléfono y sitio web.",
      id: "No se genera un código QR para las tarjetas de identificación."
    }
  },
  hi: {
    title: "इंटरैक्टिव कार्ड बिल्डर - व्यवसाय / पहचान",
    cardTypeLabel: "कार्ड का प्रकार:",
    orientationLabel: "कार्ड का अभिविन्यास:",
    widthLabel: "कार्ड की चौड़ाई (पिक्सेल):",
    heightLabel: "कार्ड की ऊंचाई (पिक्सेल):",
    colorModeLabel: "रंग मोड:",
    bgColorLabel: "कार्ड का पृष्ठभूमि रंग:",
    textColorLabel: "टेक्स्ट का रंग:",
    fontLabel: "फ़ॉन्ट शैली:",
    logoLabel: "लोगो अपलोड करें:",
    photoLabel: "फोटो / लोगो अपलोड करें:",
    borderRadiusLabel: "बॉर्डर रेडियस (पिक्सेल):",
    shadowLabel: "छाया की तीव्रता (0-1):",
    gradientLabel: "ग्रेडिएंट प्रीसेट:",
    gradStartLabel: "ग्रेडिएंट शुरू:",
    gradEndLabel: "ग्रेडिएंट अंत:",
    bgImageLabel: "पृष्ठभूमि छवि URL (वैकल्पिक):",
    fields: {
      business: ["नाम", "पद", "कंपनी", "ईमेल", "फोन", "वेबसाइट", "मुद्रा"],
      id: ["नाम", "पहचान संख्या", "विभाग", "वैधता"]
    },
    watermark: "गोपनीय",
    qrInfo: {
      business: "क्यूआर कोड में केवल आपका फोन नंबर और वेबसाइट शामिल है।",
      id: "पहचान पत्र के लिए कोई क्यूआर कोड उत्पन्न नहीं किया जाता है।"
    }
  }
};

// Gradient presets
document.querySelectorAll('.gradient-btn').forEach(btn => {
  btn.onclick = () => { 
    const card = document.getElementById('cardPreview');
    if (card) {
      card.style.background = btn.dataset.grad || `linear-gradient(135deg, ${document.getElementById('gradStart').value}, ${document.getElementById('gradEnd').value})`; 
    }
  };
});

// Apply custom gradient
document.getElementById("applyGrad").onclick = () => {
  const start = document.getElementById("gradStart")?.value;
  const end = document.getElementById("gradEnd")?.value;
  const card = document.getElementById('cardPreview');
  if (card && start && end) {
    card.style.background = `linear-gradient(135deg, ${start}, ${end})`;
  }
};

// RGB <-> CMYK functions
function rgbToCmyk(r, g, b) {
  let r1 = r / 255, g1 = g / 255, b1 = b / 255;
  let k = 1 - Math.max(r1, g1, b1);
  if (k === 1) return { c: 0, m: 0, y: 0, k: 1 };
  let c = (1 - r1 - k) / (1 - k);
  let m = (1 - g1 - k) / (1 - k);
  let y = (1 - b1 - k) / (1 - k);
  return { c, m, y, k };
}
function cmykToRgb(c, m, y, k) {
  let r = 255 * (1 - c) * (1 - k);
  let g = 255 * (1 - m) * (1 - k);
  let b = 255 * (1 - y) * (1 - k);
  return { r: Math.round(r), g: Math.round(g), b: Math.round(b) };
}

// Update card color
function updateCardColor() {
  const card = document.getElementById("cardPreview");
  const mode = document.getElementById("colorMode")?.value;
  const hex = document.getElementById("cardColor")?.value || "#1e3c72";
  const cmykDiv = document.getElementById("cmykValues");
  if (!card || !cmykDiv) return;

  const r = parseInt(hex.substr(1, 2), 16);
  const g = parseInt(hex.substr(3, 2), 16);
  const b = parseInt(hex.substr(5, 2), 16);

  if (mode === "RGB") {
    card.style.background = hex;
    cmykDiv.style.display = "none";
  } else {
    const cmyk = rgbToCmyk(r, g, b);
    const rgbPreview = cmykToRgb(cmyk.c, cmyk.m, cmyk.y, cmyk.k);
    card.style.background = `rgb(${rgbPreview.r},${rgbPreview.g},${rgbPreview.b})`;
    cmykDiv.style.display = "block";
    cmykDiv.innerHTML = `C: ${Math.round(cmyk.c * 100)}% | M: ${Math.round(cmyk.m * 100)}% | Y: ${Math.round(cmyk.y * 100)}% | K: ${Math.round(cmyk.k * 100)}%`;
  }
}

// Update text color
function updateTextColor() {
  const infoSection = document.getElementById("infoSection");
  const textColor = document.getElementById("textColor")?.value || "#ffffff";
  if (infoSection) {
    infoSection.style.color = textColor;
  }
}

// Update font style
function updateFontStyle() {
  const font = document.getElementById("fontStyle")?.value || "Segoe UI";
  const infoSection = document.getElementById("infoSection");
  if (infoSection) {
    infoSection.style.fontFamily = font;
  }
}

// Update card dimensions and border
function updateCardDimensions() {
  const card = document.getElementById("cardPreview");
  if (!card) return;
  const width = parseInt(document.getElementById("cardWidth")?.value) || 350;
  const height = parseInt(document.getElementById("cardHeight")?.value) || 200;
  const borderRadius = parseInt(document.getElementById("borderRadius")?.value) || 15;
  const shadowIntensity = parseFloat(document.getElementById("shadowIntensity")?.value) || 0.15;
  card.style.width = `${width}px`;
  card.style.height = `${height}px`;
  card.style.borderRadius = `${borderRadius}px`;
  card.style.boxShadow = `0 8px 20px rgba(0,0,0,${shadowIntensity})`;
}

// Update background image
function updateBackgroundImage() {
  const bgImage = document.getElementById("bgImage")?.value;
  const card = document.getElementById("cardPreview");
  if (!card) return;
  if (bgImage) {
    card.style.backgroundImage = `url(${bgImage})`;
    card.style.backgroundSize = "cover";
  } else {
    card.style.backgroundImage = "none";
  }
}

// QR position
function updateQRPosition(size) {
  const qrContainer = document.getElementById("qrContainer");
  if (!qrContainer) return;
  qrContainer.style.position = "absolute";
  qrContainer.style.bottom = "15px";
  qrContainer.style.right = "15px";
  qrContainer.style.width = size + "px";
  qrContainer.style.height = size + "px";
}

// Add custom field
function addCustomField() {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const customLabel = document.getElementById("customFieldLabel")?.value.trim();
  const customValue = document.getElementById("customFieldValue")?.value.trim();
  if (!customLabel || !customValue) {
    alert("Please enter both a field name and value.");
    return;
  }
  if (!customFields[type][lang]) customFields[type][lang] = [];
  customFields[type][lang].push({ label: customLabel, value: customValue });
  document.getElementById("customFieldLabel").value = "";
  document.getElementById("customFieldValue").value = "";
  renderFields();
}

// Dynamic fields based on card type
function renderFields() {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const container = document.getElementById("fieldsContainer");
  if (!container) return;
  container.innerHTML = "";
  const fields = translations[lang].fields[type];
  fields.forEach(f => {
    const div = document.createElement("div");
    div.className = "field-group";
    div.innerHTML = `<label>${f}:</label><input type="text" id="field_${f.replace(/\s+/g, '')}" aria-label="${f}">`;
    container.appendChild(div);
    div.querySelector("input").oninput = updatePreview; // Add real-time update for all fields
  });
  // Render custom fields
  if (customFields[type][lang]) {
    customFields[type][lang].forEach((cf, index) => {
      const div = document.createElement("div");
      div.className = "field-group";
      div.innerHTML = `<label>${cf.label}:</label><input type="text" id="field_custom_${index}" value="${cf.value}" aria-label="${cf.label}">`;
      container.appendChild(div);
      div.querySelector("input").oninput = updatePreview; // Add real-time update for custom fields
    });
  }
  updatePreview();
}

// Auto orientation based on type
function autoOrientation() {
  const type = document.getElementById("cardType")?.value || "business";
  const orientation = document.getElementById("cardOrientation");
  if (orientation) {
    if (type === "business") orientation.value = "horizontal";
    else orientation.value = "vertical";
  }
  updatePreview();
}

// Update watermark for ID
function updateWatermark() {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const wm = document.getElementById("watermark");
  if (!wm) return;
  if (type === "id") {
    wm.style.display = "block";
    wm.innerText = translations[lang].watermark;
  } else {
    wm.style.display = "none";
  }
}

// Update QR info message
function updateQRInfo() {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const qrInfo = document.getElementById("qrInfo");
  if (qrInfo) {
    qrInfo.textContent = translations[lang].qrInfo[type];
  }
}

// Update language and direction
function updateLanguage() {
  const lang = document.getElementById("language")?.value || "en";
  const isRtl = lang === "ar";
  document.documentElement.lang = lang;
  document.body.style.direction = isRtl ? "rtl" : "ltr";
  const cardPreview = document.getElementById("cardPreview");
  const infoSection = document.getElementById("infoSection");
  if (cardPreview) cardPreview.classList.toggle("rtl", isRtl);
  if (infoSection) infoSection.classList.toggle("rtl", isRtl);
  const title = document.getElementById("title");
  if (title) title.innerText = translations[lang].title;
  document.getElementById("cardTypeLabel").innerText = translations[lang].cardTypeLabel;
  document.getElementById("orientationLabel").innerText = translations[lang].orientationLabel;
  document.getElementById("widthLabel").innerText = translations[lang].widthLabel;
  document.getElementById("heightLabel").innerText = translations[lang].heightLabel;
  document.getElementById("colorModeLabel").innerText = translations[lang].colorModeLabel;
  document.getElementById("bgColorLabel").innerText = translations[lang].bgColorLabel;
  document.getElementById("textColorLabel").innerText = translations[lang].textColorLabel;
  document.getElementById("fontLabel").innerText = translations[lang].fontLabel;
  document.getElementById("logoLabel").innerText = translations[lang].logoLabel;
  document.getElementById("photoLabel").innerText = translations[lang].photoLabel;
  document.getElementById("borderRadiusLabel").innerText = translations[lang].borderRadiusLabel;
  document.getElementById("shadowLabel").innerText = translations[lang].shadowLabel;
  document.getElementById("gradientLabel").innerText = translations[lang].gradientLabel;
  document.getElementById("gradStartLabel").innerText = translations[lang].gradStartLabel;
  document.getElementById("gradEndLabel").innerText = translations[lang].gradEndLabel;
  document.getElementById("bgImageLabel").innerText = translations[lang].bgImageLabel;
  renderFields();
  updateQRInfo();
}

// Update preview
function updatePreview() {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const card = document.getElementById("cardPreview");
  const orientation = document.getElementById("cardOrientation")?.value || "horizontal";
  if (!card) return;
  card.classList.toggle("vertical", orientation === "vertical");

  const infoSection = document.getElementById("infoSection");
  const profile = document.getElementById("profilePic");
  const logo = document.getElementById("logo");
  const companyName = document.getElementById("companyName");
  const contactDetails = document.getElementById("contactDetails");
  if (!infoSection || !profile || !logo || !companyName || !contactDetails) return;
  infoSection.innerHTML = "";
  profile.style.display = "none";
  logo.style.display = "none";

  const fields = translations[lang].fields[type];
  const fieldValues = fields.map(f => {
    const field = document.getElementById(`field_${f.replace(/\s+/g, '')}`);
    return field ? field.value || "" : "";
  });

  if (type === "business") {
    companyName.textContent = fieldValues[2];
    let detailsHTML = `
      <h2 id="displayMain">${fieldValues[0]}</h2> <!-- Name -->
      <p data-label="${translations[lang].fields.business[1]}">${fieldValues[1]}</p>
      <p data-label="${translations[lang].fields.business[3]}">${fieldValues[3]}</p>
      <p data-label="${translations[lang].fields.business[4]}">${fieldValues[4]}</p>
      <p data-label="${translations[lang].fields.business[5]}">${fieldValues[5]}</p>
      <p data-label="${translations[lang].fields.business[6]}">${fieldValues[6]}</p>
    `;
    // Add custom fields
    if (customFields[type][lang]) {
      customFields[type][lang].forEach((cf, index) => {
        const field = document.getElementById(`field_custom_${index}`);
        const value = field ? field.value || "" : cf.value;
        detailsHTML += `<p data-label="${cf.label}">${value}</p>`;
      });
    }
    contactDetails.innerHTML = detailsHTML;
    infoSection.appendChild(logo);
    infoSection.appendChild(companyName);
    infoSection.appendChild(contactDetails);
    if (document.getElementById("logoImg")?.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        logo.src = e.target.result;
        logo.style.display = "block";
      };
      reader.readAsDataURL(document.getElementById("logoImg").files[0]);
    }
    if (document.getElementById("profileImg")?.files[0]) profile.style.display = "block";
  } else {
    let detailsHTML = `
      <h2 id="displayMain">${fieldValues[0]}</h2> <!-- Name -->
      <p data-label="${translations[lang].fields.id[1]}">${fieldValues[1]}</p> <!-- ID Number -->
      <p data-label="${translations[lang].fields.id[2]}">${fieldValues[2]}</p> <!-- Department -->
      <p data-label="${translations[lang].fields.id[3]}">${fieldValues[3]}</p> <!-- Validity -->
    `;
    // Add custom fields
    if (customFields[type][lang]) {
      customFields[type][lang].forEach((cf, index) => {
        const field = document.getElementById(`field_custom_${index}`);
        const value = field ? field.value || "" : cf.value;
        detailsHTML += `<p data-label="${cf.label}">${value}</p>`;
      });
    }
    contactDetails.innerHTML = detailsHTML;
    infoSection.appendChild(contactDetails);
    if (document.getElementById("profileImg")?.files[0]) profile.style.display = "block";
  }

  updateCardColor();
  updateTextColor();
  updateFontStyle();
  updateCardDimensions();
  updateBackgroundImage();
  updateWatermark();
}

// Event listeners
document.getElementById("language").onchange = updateLanguage;
document.getElementById("cardType").onchange = () => {
  renderFields();
  autoOrientation();
  updateQRInfo();
};
document.getElementById("colorMode").onchange = updateCardColor;
document.getElementById("cardColor").oninput = updateCardColor;
document.getElementById("textColor").oninput = updateTextColor;
document.getElementById("fontStyle").onchange = updateFontStyle;
document.getElementById("cardWidth").oninput = updateCardDimensions;
document.getElementById("cardHeight").oninput = updateCardDimensions;
document.getElementById("borderRadius").oninput = updateCardDimensions;
document.getElementById("shadowIntensity").oninput = updateCardDimensions;
document.getElementById("bgImage").oninput = updateBackgroundImage;
document.getElementById("addCustomField").onclick = addCustomField;

// Generate QR & Preview
document.getElementById("generateBtn").onclick = async () => {
  const type = document.getElementById("cardType")?.value || "business";
  const lang = document.getElementById("language")?.value || "en";
  const qrCode = document.getElementById("qrcode");
  if (!qrCode) return;

  updateQRPosition(100);

  if (type === "business") {
    const phone = document.getElementById("field_Phone")?.value || "";
    const website = document.getElementById("field_Website")?.value || "";
    const vcard = `BEGIN:VCARD
VERSION:3.0
${phone ? `TEL:${phone}` : ""}
${website ? `URL:${website}` : ""}
END:VCARD`;
    currentSVG = await QRCode.toString(vcard, { type: 'svg', width: 100, color: { dark: "#000000", light: "#ffffff" } });
    qrCode.innerHTML = currentSVG;
    alert(translations[lang].qrInfo.business);
  } else {
    qrCode.innerHTML = "";
    currentSVG = "";
    alert(translations[lang].qrInfo.id);
  }
};

// Logo image upload
document.getElementById("logoImg").onchange = function () {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const logo = document.getElementById("logo");
      if (logo) {
        logo.src = e.target.result;
        logo.style.display = "block";
        updatePreview();
      }
    };
    reader.readAsDataURL(file);
  }
};

// Profile image upload
document.getElementById("profileImg").onchange = function () {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = document.getElementById("profilePic");
      if (img) {
        img.src = e.target.result;
        img.style.display = "block";
        updatePreview();
      }
    };
    reader.readAsDataURL(file);
  }
};

// Download PNG
document.getElementById("downloadPNGBtn").onclick = async () => {
  const cardPreview = document.getElementById("cardPreview");
  if (!cardPreview) return;
  const width = parseInt(document.getElementById("cardWidth")?.value) || 350;
  const height = parseInt(document.getElementById("cardHeight")?.value) || 200;
  const scale = 4;

  const svgBlob = new Blob([cardPreview.outerHTML], { type: "image/svg+xml;charset=utf-8" });
  const url = URL.createObjectURL(svgBlob);
  const img = new Image();
  img.onload = async function () {
    const canvas = document.createElement("canvas");
    canvas.width = width * scale;
    canvas.height = height * scale;
    const ctx = canvas.getContext("2d");
    if (!ctx) return;
    ctx.fillStyle = document.getElementById("cardColor")?.value || "#1e3c72";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const qrCodeElement = document.getElementById("qrcode");
    if (qrCodeElement && currentSVG) {
      const qrBlob = new Blob([currentSVG], { type: "image/svg+xml;charset=utf-8" });
      const qrURL = URL.createObjectURL(qrBlob);
      const qrImg = new Image();
      qrImg.onload = function () {
        const qrSize = 100 * scale;
        ctx.drawImage(qrImg, canvas.width - qrSize - (15 * scale), canvas.height - qrSize - (15 * scale), qrSize, qrSize);
        const pngUrl = canvas.toDataURL("image/png");
        const a = document.createElement("a");
        a.href = pngUrl;
        a.download = "custom_card.png";
        a.click();
        URL.revokeObjectURL(qrURL);
      };
      qrImg.onerror = () => {
        console.error("Failed to load QR SVG");
        URL.revokeObjectURL(qrURL);
      };
      qrImg.src = qrURL;
    } else {
      const pngUrl = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = pngUrl;
      a.download = "custom_card.png";
      a.click();
    }
    URL.revokeObjectURL(url);
  };
  img.onerror = () => {
    console.error("Failed to load SVG for PNG conversion");
    URL.revokeObjectURL(url);
  };
  img.src = url;
};

// Initialize
renderFields();
updateLanguage();
autoOrientation();
updateQRInfo();
</script>
</body>
</html>