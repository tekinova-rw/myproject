<!DOCTYPE html>
<html lang="rw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="description" content="Card Builder - Create Custom Business and ID Cards"/>
  <meta name="keywords" content="Card Builder, Business Card, ID Card, QR code"/>
  <meta name="author" content="Jobs and Scholarships Team"/>
  <title>Card Builder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="strict-origin-when-cross-origin"/>
  <style>
    /* Fallback if Font Awesome fails */
    .fa, .fas { font-family: sans-serif; }
    .fa-home::before { content: "\2302"; }
    .fa-cogs::before { content: "\2699"; }
    .fa-bars::before { content: "\2630"; }
    .fa-times::before { content: "\2715"; }
    .fa-check-circle::before { content: "\2713"; }
    .fa-user-plus::before { content: "\1F464"; }
    .fa-sync-alt::before { content: "\21BB"; }
    .fa-paint-brush::before { content: "\1F3A8"; }
    .fa-camera::before { content: "\1F4F7"; }
    .fa-file-alt::before { content: "\1F4C4"; }

    /* Reset and Global Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      color: #333;
      line-height: 1.6;
    }

    body.no-scroll {
      overflow: hidden;
    }

    /* Header */
    header {
      background-color: #012f47;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .logo img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid gold;
      margin-right: 12px;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    .logo:hover img {
      transform: rotate(15deg);
    }

    .logo h1 {
      color: gold;
      font-size: clamp(18px, 5vw, 22px);
      font-weight: 700;
      white-space: nowrap;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 15px;
    }

    .navbar a {
      text-decoration: none;
      color: white;
      font-weight: 600;
      font-size: 16px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background-color 0.3s ease;
      position: relative;
    }

    .navbar a:hover {
      background-color: #033d3d;
      color: gold;
    }

    .navbar a.active {
      color: #eaedf1;
    }

    .navbar a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: gold;
      transition: width 0.3s ease, transform 0.3s ease;
      transform: translateX(-50%);
    }

    .navbar a:hover::after {
      width: 80%;
    }

    /* Dashboard Icon */
    .dashboard-icon {
      font-size: 24px;
      cursor: pointer;
      color: white;
      transition: color 0.3s ease, transform 0.3s ease;
      padding: 5px;
      will-change: transform, color;
    }

    .dashboard-icon:hover {
      color: gold;
      transform: scale(1.1);
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      right: -100%;
      width: 280px;
      max-width: 80vw;
      height: 100vh;
      background-color: #002240;
      color: white;
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 999;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.2);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar.active {
      right: 0;
    }

    .sidebar::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 4px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: #002240;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 20px;
      color: gold;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 1px solid #555;
    }

    .sidebar-header i {
      cursor: pointer;
      transition: color 0.3s ease, transform 0.3s ease;
      font-size: 18px;
      will-change: transform, color;
    }

    .sidebar-header i:hover {
      color: #d4af37;
      transform: scale(1.2);
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      padding: 12px 15px;
      text-decoration: none;
      transition: background-color 0.3s ease, color 0.3s ease;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 15px;
      border-radius: 5px;
    }

    .sidebar a:hover {
      background-color: #033d3d;
      color: gold;
    }

    .sidebar i {
      width: 20px;
      text-align: center;
      font-size: 15px;
    }

    /* Sidebar Overlay */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      z-index: 998;
    }

    .sidebar-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Content Blur when Sidebar is Active */
    body.sidebar-active .main-content,
    body.sidebar-active footer {
      filter: blur(1px);
      transition: filter 0.3s ease;
    }

    body:not(.sidebar-active) .main-content,
    body:not(.sidebar-active) footer {
      filter: none;
    }

    /* Dashboard Widgets */
    .dashboard-widget {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      transition: transform 0.3s ease;
      will-change: transform;
    }

    .dashboard-widget:hover {
      transform: translateY(-3px);
    }

    .dashboard-widget h3 {
      color: gold;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .dashboard-widget p {
      font-size: 14px;
      margin-bottom: 8px;
    }

    .dashboard-widget .widget-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .widget-stats div {
      text-align: center;
      flex: 1;
      min-width: 80px;
    }

    .widget-stats span {
      display: block;
      font-size: 18px;
      font-weight: bold;
      color: gold;
    }

    .widget-stats small {
      font-size: 12px;
      opacity: 0.8;
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 80px auto 40px;
      padding: 20px;
    }

    .main-content h1 {
      text-align: center;
      font-size: clamp(1.8rem, 5vw, 2.2rem);
      color: #002744;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid gold;
      padding-bottom: 8px;
    }

    /* Sliding Gallery */
    .sliding-gallery {
      max-width: 100%;
      overflow: hidden;
      border-radius: 10px;
      margin: 1px auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .gallery-track {
      display: flex;
      width: max-content;
      animation: slideGallery 8s linear infinite;
    }

    .gallery-track img {
      width: 100%;
      max-width: 480px;
      flex-shrink: 0;
      object-fit: cover;
      margin-right: 8px;
      border-radius: 10px;
    }

    @keyframes slideGallery {
      0% { transform: translateX(0); }
      33% { transform: translateX(-100%); }
      66% { transform: translateX(-200%); }
      100% { transform: translateX(0); }
    }

    /* Card Builder Styles */
    .card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }

    .controls {
      flex: 1;
      min-width: 320px;
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .card-display {
      flex: 1;
      min-width: 350px;
    }

    .card-preview {
      width: 350px;
      height: 200px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      position: relative;
      display: flex;
      padding: 15px;
      overflow: hidden;
      margin-bottom: 15px;
      flex-direction: column;
      background: linear-gradient(135deg, #012f47, #002240);
      transition: all 0.3s ease;
    }

    .card-preview.vertical {
      height: 350px;
    }

    .card-preview.rtl {
      direction: rtl;
    }

    .info-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      padding: 15px;
      color: gold;
    }

    .info-section.rtl {
      padding-right: 0;
      padding-left: 15px;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      align-self: flex-start;
      border: 2px solid gold;
    }

    .company-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
      word-wrap: break-word;
    }

    .contact-details {
      font-size: 12px;
      line-height: 1.6;
      margin: 5px 0;
    }

    .contact-details p {
      margin: 3px 0;
      font-size: 12px;
      word-wrap: break-word;
    }

    .contact-details h2 {
      font-size: 16px;
      margin: 3px 0;
    }

    .qr-section {
      position: absolute;
      bottom: 15px;
      right: 15px;
      width: 100px;
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #ffffff;
      padding: 5px;
      border-radius: 5px;
      border: 1px solid gold;
    }

    .qr-section svg {
      width: 100%;
      height: 100%;
    }

    .card-watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      font-size: 50px;
      color: rgba(0, 0, 0, 0.05);
      transform: translate(-50%, -50%) rotate(-30deg);
      pointer-events: none;
      white-space: nowrap;
      user-select: none;
    }

    input, select {
      width: 100%;
      margin: 5px 0;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-family: inherit;
      font-size: 14px;
    }

    button {
      padding: 10px;
      border-radius: 6px;
      border: none;
      background: #012f47;
      color: white;
      cursor: pointer;
      margin-top: 5px;
      width: 100%;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background: #033d3d;
    }

    .gradient-btn {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #012f47;
      color: white;
    }

    .gradient-btn:hover {
      background: #033d3d;
    }

    .cmyk-values {
      margin-top: 10px;
      background: #f4f4f4;
      padding: 5px;
      border-radius: 5px;
      font-size: 12px;
    }

    .field-group {
      margin-bottom: 10px;
    }

    .info-section p::before {
      content: attr(data-label) ": ";
    }

    .qr-info {
      font-size: 14px;
      color: #333;
      margin-bottom: 10px;
      padding: 10px;
      background: #ffffff;
      border-radius: 5px;
    }

    /* Footer */
    footer {
      background-color: #012f47;
      color: white;
      padding: 40px 20px;
      width: 100%;
    }

    .footer-columns {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-columns .col {
      flex: 1;
      min-width: 200px;
      margin-bottom: 15px;
    }

    .footer-columns .col h3 {
      color: gold;
      margin-bottom: 12px;
      font-size: 16px;
    }

    .footer-columns .col a {
      display: block;
      color: white;
      text-decoration: none;
      margin-bottom: 6px;
      transition: color 0.3s ease, padding-left 0.3s ease;
      font-size: 14px;
    }

    .footer-columns .col a:hover {
      color: #d4af37;
      padding-left: 5px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      header {
        padding: 10px 15px;
      }

      .logo {
        min-width: 100%;
        justify-content: center;
        margin-bottom: 8px;
      }

      .navbar {
        display: none;
      }

      .dashboard-icon {
        display: block !important;
        margin-left: auto;
        margin-right: 15px;
      }

      .sidebar {
        width: 80vw;
        max-width: 300px;
      }

      .main-content {
        margin: 70px auto 20px;
        padding: 15px;
      }

      .sliding-gallery .gallery-track img {
        max-width: 300px;
      }

      .card-container {
        flex-direction: column;
      }

      .controls, .card-display {
        min-width: 100%;
      }

      .card-preview {
        width: 100%;
        max-width: 350px;
      }

      .footer-columns {
        flex-direction: column;
        gap: 30px;
      }

      .footer-columns .col {
        min-width: 100%;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 8px 10px;
      }

      .logo img {
        width: 36px;
        height: 36px;
      }

      .logo h1 {
        font-size: 16px;
      }

      .dashboard-icon {
        font-size: 20px;
        margin-right: 10px;
      }

      .sidebar {
        width: 90vw;
        max-width: 100%;
      }

      .dashboard-widget .widget-stats {
        flex-direction: column;
        align-items: center;
      }

      .sliding-gallery .gallery-track img {
        max-width: 200px;
      }

      .main-content h1 {
        font-size: 1.8rem;
      }

      .card-preview {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo" id="logo">
      <img src="https://via.placeholder.com/48" alt="Card Builder Logo">
      <h1>Card Builder</h1>
    </div>
    <nav class="navbar">
      <ul id="main-nav" role="navigation" aria-label="Main navigation">
        <li><a href="index.html" class="active">Card Builder</a></li>
      </ul>
    </nav>
    <div class="dashboard-icon" id="dashboard-icon" role="button" aria-label="Toggle dashboard menu" tabindex="0">
      <i class="fas fa-bars"></i>
    </div>
  </header>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <!-- Sidebar (Dashboard) -->
  <aside class="sidebar" id="dashboard" role="navigation" aria-label="Dashboard menu">
    <div class="sidebar-header">
      <span><i class="fas fa-cogs"></i> Dashboard</span>
      <i class="fas fa-times" id="close-dashboard" role="button" aria-label="Close dashboard menu" tabindex="0"></i>
    </div>
    <nav>
      <a href="index.html"><i class="fas fa-cogs"></i> Card Builder</a>
    </nav>
    <div class="dashboard-widget">
      <h3>Quick Stats</h3>
      <p>Overview of your recent activity</p>
      <div class="widget-stats">
        <div>
          <span id="visitors-count">1,245</span>
          <small>Visitors</small>
        </div>
        <div>
          <span>24</span>
          <small>Cards Generated</small>
        </div>
        <div>
          <span>18</span>
          <small>Downloads</small>
        </div>
      </div>
    </div>
    <div class="dashboard-widget">
      <h3>Recent Activity</h3>
      <p><i class="fas fa-check-circle"></i> New card generated</p>
      <p><i class="fas fa-user-plus"></i> Profile updated</p>
      <p><i class="fas fa-sync-alt"></i> Card downloaded</p>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <h1>Create Your Custom Card</h1>
    <div class="sliding-gallery">
      <div class="gallery-track">
        <img src="business_card.jpg" alt="Business card example">
        <img src="id_card.jpg" alt="ID card example">
        <img src="resume_card.jpg" alt="Resume card example">
      </div>
    </div>
    <div class="card-container">
      <div class="controls" role="region" aria-label="Card customization controls">
        <div class="field-group">
          <label for="language">Ururimi / Language:</label>
          <select id="language" aria-label="Select language for card">
            <option value="rw">Kinyarwanda</option>
            <option value="en">English</option>
            <option value="ar">Arabic</option>
            <option value="zh">Chinese</option>
            <option value="es">Spanish</option>
            <option value="hi">Hindi</option>
          </select>
        </div>
        <div class="field-group">
          <label id="cardTypeLabel" for="cardType">Ubwoko bw'Ikarita / Card Type:</label>
          <select id="cardType" aria-label="Select card type">
            <option value="business">Ikarita y'ubucuruzi / Business Card</option>
            <option value="id">Ikarita ya'akazi / ID Card</option>
            <option value="resume">Resume</option>
            <option value="photo">Photo Editor</option>
            <option value="document">Document Scanner</option>
          </select>
        </div>
        <div class="field-group">
          <label id="orientationLabel" for="cardOrientation">Icyerekezo cy'Ikarita / Card Orientation:</label>
          <select id="cardOrientation" aria-label="Select card orientation">
            <option value="horizontal">ikarita itambitse / Horizontal</option>
            <option value="vertical">Ikarita ihagaze / Vertical</option>
          </select>
        </div>
        <div class="field-group">
          <label id="colorModeLabel" for="colorMode">Uburyo bwo guhitamo Amabara / Color Mode:</label>
          <select id="colorMode" aria-label="Select color mode">
            <option value="RGB">RGB (Hitamo / Screen)</option>
            <option value="CMYK">CMYK (Gucapa / Print)</option>
          </select>
        </div>
        <div class="field-group">
          <label><input type="checkbox" id="useGradient" aria-label="Enable gradient background"> Use Gradient Background</label>
        </div>
        <div class="field-group" id="gradientControls" style="display: none;">
          <label for="gradientColor1">Gradient Color 1:</label>
          <input type="color" id="gradientColor1" value="#012f47" aria-label="Select first gradient color">
          <label for="gradientColor2">Gradient Color 2:</label>
          <input type="color" id="gradientColor2" value="#002240" aria-label="Select second gradient color">
          <label for="gradientDirection">Gradient Direction:</label>
          <select id="gradientDirection" aria-label="Select gradient direction">
            <option value="to right">To Right</option>
            <option value="to left">To Left</option>
            <option value="to bottom">To Bottom</option>
            <option value="to top">To Top</option>
            <option value="135deg">Diagonal (135deg)</option>
          </select>
        </div>
        <div class="field-group">
          <label id="bgColorLabel" for="cardColor">Ibara ry'Ibikurikira / Card Background Color:</label>
          <input type="color" id="cardColor" value="#012f47" aria-label="Select card background color">
          <label id="textColorLabel" for="textColor">Ibara ry'Inyandiko / Text Color:</label>
          <input type="color" id="textColor" value="#d4af37" aria-label="Select text color">
        </div>
        <div class="field-group">
          <label id="fontLabel" for="fontStyle">Uburyo bw'Inyuguti / Font Style:</label>
          <select id="fontStyle" aria-label="Select font style">
            <option value="Segoe UI">Segoe UI</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Arial">Arial</option>
            <option value="Noto Sans Arabic">Noto Sans Arabic</option>
            <option value="Noto Sans SC">Noto Sans Chinese</option>
            <option value="Noto Sans Devanagari">Noto Sans Hindi</option>
          </select>
        </div>
        <div class="field-group">
          <label id="logoLabel" for="logoImg">Shyiraho Logo / Upload Logo:</label>
          <input type="file" id="logoImg" accept="image/*" aria-label="Upload logo image">
        </div>
        <div class="field-group">
          <label id="fieldsContainerLabel">Amakuru / Details:</label>
          <div id="fieldsContainer"></div>
        </div>
        <div class="cmyk-values" id="cmykValues" style="display:none;"></div>
        <button id="generateBtn" aria-label="Generate QR code and preview card">Kora Ikari / Generate Card</button>
        <button id="downloadPNGBtn" aria-label="Download card as high-resolution PNG">Kuramo Ikari / Download PNG</button>
      </div>
      <div class="card-display" role="region" aria-label="Generated card preview">
        <h2>Ikarita Yabonetse / Generated Card</h2>
        <p class="qr-info" id="qrInfo">Ikari y'ubucuruzi izagira QR code y'umurongo wa terefone na website, ariko ikari y'ubwiza ntizagira QR code. / The QR code for business cards contains only your phone number and website; ID cards have no QR code.</p>
        <div id="cardPreview" class="card-preview">
          <div class="info-section" id="infoSection">
            <img id="logo" src="" alt="Company or personal logo" class="logo" style="display:none;">
            <div class="company-name" id="companyName"></div>
            <div class="contact-details" id="contactDetails"></div>
          </div>
          <div class="qr-section" id="qrContainer">
            <div id="qrcode" style="width:100px;height:100px;"></div>
          </div>
          <div id="watermark" class="card-watermark" style="display:none;">BIRAHAMBARA / CONFIDENTIAL</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-columns">
      <div class="col">
        <h3>Contact</h3>
        <p><strong>WhatsApp:</strong> <a href="https://wa.me/+250733253803" target="_blank" rel="noopener noreferrer">+250 733 253 803</a></p>
        <p><strong>Email:</strong> <a href="mailto:info@jobsandscholarships.com" rel="noopener noreferrer">info@jobsandscholarships.com</a></p>
      </div>
      <div class="col">
        <h3>Card Builder</h3>
        <a href="index.html">Create Your Card</a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    // Card Builder Data
    let currentSVG = "";
    let customFields = { business: {}, id: {}, resume: {}, photo: {}, document: {} };

    const translations = {
      rw: {
        title: "Ikoresho ry'Ikari - Ubucuruzi / Ubwiza",
        cardTypeLabel: "Ubwoko bw'Ikari:",
        orientationLabel: "Icyerekezo cy'Ikari:",
        colorModeLabel: "Uburyo bw'Amabara:",
        bgColorLabel: "Ibara ry'Ibikurikira:",
        textColorLabel: "Ibara ry'Inyandiko:",
        fontLabel: "Uburyo bw'Inyuguti:",
        logoLabel: "Shyiraho Logo:",
        fieldsContainerLabel: "Amakuru:",
        fields: {
          business: ["Izina", "Umunyamabanga", "Kampuni", "Imeri", "Terefone", "Urubuga", "Ifaranga"],
          id: ["Izina", "Nimero y'Ikari", "Ishami", "Igihe Gikora"],
          resume: ["Izina", "Umunyamabanga", "Imeri", "Terefone", "Umurimo Wakoze", "Uburezi"],
          photo: ["Izina", "Ibara ry'Ibikurikira", "Ibara ry'Ibirimo", "Ubunini"],
          document: ["Izina ry'Inyandiko", "Ubwoko bw'Inyandiko", "Igihe cy'Urwandiko"]
        },
        watermark: "BIRAHAMBARA",
        qrInfo: {
          business: "QR code ya ikari y'ubucuruzi izagira gusa nimero ya terefone na urubuga rwawe.",
          id: "Ikari y'ubwiza nta QR code izaba ifite.",
          resume: "QR code ya resume izagira amakuru y'ibanze.",
          photo: "Nta QR code kuri foto.",
          document: "Nta QR code kuri inyandiko."
        }
      },
      en: {
        title: "Interactive Card Builder - Business / ID / Resume / Photo / Document",
        cardTypeLabel: "Card Type:",
        orientationLabel: "Card Orientation:",
        colorModeLabel: "Color Mode:",
        bgColorLabel: "Card Background Color:",
        textColorLabel: "Text Color:",
        fontLabel: "Font Style:",
        logoLabel: "Upload Logo:",
        fieldsContainerLabel: "Details:",
        fields: {
          business: ["Name", "Position", "Company", "Email", "Phone", "Website", "Currency"],
          id: ["Name", "ID Number", "Department", "Validity"],
          resume: ["Name", "Position", "Email", "Phone", "Work Experience", "Education"],
          photo: ["Name", "Background Color", "Content Color", "Size"],
          document: ["Document Name", "Document Type", "Date Issued"]
        },
        watermark: "CONFIDENTIAL",
        qrInfo: {
          business: "The QR code contains only your phone number and website.",
          id: "No QR code is generated for ID cards.",
          resume: "The QR code contains your basic contact details.",
          photo: "No QR code for photos.",
          document: "No QR code for documents."
        }
      },
      ar: {
        title: "منشئ البطاقات التفاعلية - الأعمال / الهوية / السيرة الذاتية / الصورة / المستند",
        cardTypeLabel: "نوع البطاقة:",
        orientationLabel: "اتجاه البطاقة:",
        colorModeLabel: "وضع الألوان:",
        bgColorLabel: "لون خلفية البطاقة:",
        textColorLabel: "لون النص:",
        fontLabel: "نمط الخط:",
        logoLabel: "رفع الشعار:",
        fieldsContainerLabel: "التفاصيل:",
        fields: {
          business: ["الاسم", "المنصب", "الشركة", "البريد الإلكتروني", "الهاتف", "الموقع الإلكتروني", "العملة"],
          id: ["الاسم", "رقم الهوية", "القسم", "الصلاحية"],
          resume: ["الاسم", "المنصب", "البريد الإلكتروني", "الهاتف", "الخبرة العملية", "التعليم"],
          photo: ["الاسم", "لون الخلفية", "لون المحتوى", "الحجم"],
          document: ["اسم المستند", "نوع المستند", "تاريخ الإصدار"]
        },
        watermark: "سري",
        qrInfo: {
          business: "رمز الاستجابة السريعة يحتوي فقط على رقم هاتفك وموقعك الإلكتروني.",
          id: "لا يتم إنشاء رمز الاستجابة السريعة لبطاقات الهوية.",
          resume: "رمز الاستجابة السريعة يحتوي على تفاصيل الاتصال الأساسية الخاصة بك.",
          photo: "لا يوجد رمز استجابة سريعة للصور.",
          document: "لا يوجد رمز استجابة سريعة للمستندات."
        }
      },
      zh: {
        title: "交互式卡片生成器 - 商务 / 身份 / 简历 / 照片 / 文档",
        cardTypeLabel: "卡片类型:",
        orientationLabel: "卡片方向:",
        colorModeLabel: "颜色模式:",
        bgColorLabel: "卡片背景颜色:",
        textColorLabel: "文本颜色:",
        fontLabel: "字体样式:",
        logoLabel: "上传标志:",
        fieldsContainerLabel: "详细信息:",
        fields: {
          business: ["姓名", "职位", "公司", "电子邮件", "电话", "网站", "货币"],
          id: ["姓名", "身份证号", "部门", "有效期"],
          resume: ["姓名", "职位", "电子邮件", "电话", "工作经验", "教育"],
          photo: ["名称", "背景颜色", "内容颜色", "大小"],
          document: ["文档名称", "文档类型", "发行日期"]
        },
        watermark: "机密",
        qrInfo: {
          business: "二维码仅包含您的电话号码和网站。",
          id: "身份证不生成二维码。",
          resume: "二维码包含您的基本联系信息。",
          photo: "照片无二维码。",
          document: "文档无二维码。"
        }
      },
      es: {
        title: "Creador de Tarjetas Interactivas - Negocios / Identificación / Currículum / Foto / Documento",
        cardTypeLabel: "Tipo de Tarjeta:",
        orientationLabel: "Orientación de la Tarjeta:",
        colorModeLabel: "Modo de Color:",
        bgColorLabel: "Color de Fondo de la Tarjeta:",
        textColorLabel: "Color del Texto:",
        fontLabel: "Estilo de Fuente:",
        logoLabel: "Subir Logotipo:",
        fieldsContainerLabel: "Detalles:",
        fields: {
          business: ["Nombre", "Puesto", "Compañía", "Correo Electrónico", "Teléfono", "Sitio Web", "Moneda"],
          id: ["Nombre", "Número de Identificación", "Departamento", "Validez"],
          resume: ["Nombre", "Puesto", "Correo Electrónico", "Teléfono", "Experiencia Laboral", "Educación"],
          photo: ["Nombre", "Color de Fondo", "Color del Contenido", "Tamaño"],
          document: ["Nombre del Documento", "Tipo de Documento", "Fecha de Emisión"]
        },
        watermark: "CONFIDENCIAL",
        qrInfo: {
          business: "El código QR contiene solo su número de teléfono y sitio web.",
          id: "No se genera un código QR para las tarjetas de identificación.",
          resume: "El código QR contiene sus datos de contacto básicos.",
          photo: "No hay código QR para fotos.",
          document: "No hay código QR para documentos."
        }
      },
      hi: {
        title: "इंटरैक्टिव कार्ड बिल्डर - व्यवसाय / पहचान / रिज्यूमे / फोटो / दस्तावेज़",
        cardTypeLabel: "कार्ड का प्रकार:",
        orientationLabel: "कार्ड का अभिविन्यास:",
        colorModeLabel: "रंग मोड:",
        bgColorLabel: "कार्ड का पृष्ठभूमि रंग:",
        textColorLabel: "टेक्स्ट का रंग:",
        fontLabel: "फ़ॉन्ट शैली:",
        logoLabel: "लोगो अपलोड करें:",
        fieldsContainerLabel: "विवरण:",
        fields: {
          business: ["नाम", "पद", "कंपनी", "ईमेल", "फोन", "वेबसाइट", "मुद्रा"],
          id: ["नाम", "पहचान संख्या", "विभाग", "वैधता"],
          resume: ["नाम", "पद", "ईमेल", "फोन", "कार्य अनुभव", "शिक्षा"],
          photo: ["नाम", "पृष्ठभूमि रंग", "सामग्री रंग", "आकार"],
          document: ["दस्तावेज़ का नाम", "दस्तावेज़ का प्रकार", "जारी करने की तारीख"]
        },
        watermark: "गोपनीय",
        qrInfo: {
          business: "क्यूआर कोड में केवल आपका फोन नंबर और वेबसाइट शामिल है।",
          id: "पहचान पत्र के लिए कोई क्यूआर कोड उत्पन्न नहीं किया जाता है।",
          resume: "क्यूआर कोड में आपकी बुनियादी संपर्क जानकारी शामिल है।",
          photo: "फोटो के लिए कोई क्यूआर कोड नहीं।",
          document: "दस्तावेज़ों के लिए कोई क्यूआर कोड नहीं।"
        }
      }
    };

    // RGB <-> CMYK functions
    function rgbToCmyk(r, g, b) {
      let r1 = r / 255, g1 = g / 255, b1 = b / 255;
      let k = 1 - Math.max(r1, g1, b1);
      if (k === 1) return { c: 0, m: 0, y: 0, k: 1 };
      let c = (1 - r1 - k) / (1 - k);
      let m = (1 - g1 - k) / (1 - k);
      let y = (1 - b1 - k) / (1 - k);
      return { c, m, y, k };
    }

    function cmykToRgb(c, m, y, k) {
      let r = 255 * (1 - c) * (1 - k);
      let g = 255 * (1 - m) * (1 - k);
      let b = 255 * (1 - y) * (1 - k);
      return { r: Math.round(r), g: Math.round(g), b: Math.round(b) };
    }

    // Update card color with gradient support
    function updateCardColor() {
      const card = document.getElementById("cardPreview");
      const mode = document.getElementById("colorMode")?.value;
      const useGradient = document.getElementById("useGradient")?.checked;
      const cmykDiv = document.getElementById("cmykValues");
      if (!card || !cmykDiv) return;

      if (useGradient) {
        const color1 = document.getElementById("gradientColor1")?.value || "#012f47";
        const color2 = document.getElementById("gradientColor2")?.value || "#002240";
        const direction = document.getElementById("gradientDirection")?.value || "to right";
        card.style.background = `linear-gradient(${direction}, ${color1}, ${color2})`;
        cmykDiv.style.display = "none";
      } else {
        const hex = document.getElementById("cardColor")?.value || "#012f47";
        const r = parseInt(hex.substr(1, 2), 16);
        const g = parseInt(hex.substr(3, 2), 16);
        const b = parseInt(hex.substr(5, 2), 16);

        if (mode === "RGB") {
          card.style.background = hex;
          cmykDiv.style.display = "none";
        } else {
          const cmyk = rgbToCmyk(r, g, b);
          const rgbPreview = cmykToRgb(cmyk.c, cmyk.m, cmyk.y, cmyk.k);
          card.style.background = `rgb(${rgbPreview.r},${rgbPreview.g},${rgbPreview.b})`;
          cmykDiv.style.display = "block";
          cmykDiv.innerHTML = `C: ${Math.round(cmyk.c * 100)}% | M: ${Math.round(cmyk.m * 100)}% | Y: ${Math.round(cmyk.y * 100)}% | K: ${Math.round(cmyk.k * 100)}%`;
        }
      }
    }

    // Update text color
    function updateTextColor() {
      const infoSection = document.getElementById("infoSection");
      const textColor = document.getElementById("textColor")?.value || "#d4af37";
      if (infoSection) {
        infoSection.style.color = textColor;
      }
    }

    // Update font style
    function updateFontStyle() {
      const font = document.getElementById("fontStyle")?.value || "Segoe UI";
      const infoSection = document.getElementById("infoSection");
      if (infoSection) {
        infoSection.style.fontFamily = font;
      }
    }

    // Dynamic fields based on card type
    function renderFields() {
      const type = document.getElementById("cardType")?.value || "business";
      const lang = document.getElementById("language")?.value || "rw";
      const container = document.getElementById("fieldsContainer");
      if (!container) return;
      container.innerHTML = "";
      const fields = translations[lang].fields[type];
      fields.forEach(f => {
        const div = document.createElement("div");
        div.className = "field-group";
        div.innerHTML = `<label>${f}:</label><input type="text" id="field_${f.replace(/\s+/g, '')}" aria-label="${f}">`;
        container.appendChild(div);
        div.querySelector("input").oninput = updatePreview;
      });
      updatePreview();
    }

    // Auto orientation based on type
    function autoOrientation() {
      const type = document.getElementById("cardType")?.value || "business";
      const orientation = document.getElementById("cardOrientation");
      if (orientation) {
        if (type === "business" || type === "photo") orientation.value = "horizontal";
        else orientation.value = "vertical";
      }
      updatePreview();
    }

    // Update watermark for ID
    function updateWatermark() {
      const type = document.getElementById("cardType")?.value || "business";
      const lang = document.getElementById("language")?.value || "rw";
      const wm = document.getElementById("watermark");
      if (!wm) return;
      if (type === "id" || type === "document") {
        wm.style.display = "block";
        wm.innerText = translations[lang].watermark;
      } else {
        wm.style.display = "none";
      }
    }

    // Update QR info message
    function updateQRInfo() {
      const type = document.getElementById("cardType")?.value || "business";
      const lang = document.getElementById("language")?.value || "rw";
      const qrInfo = document.getElementById("qrInfo");
      if (qrInfo) {
        qrInfo.textContent = translations[lang].qrInfo[type];
      }
    }

    // Update language and direction
    function updateLanguage() {
      const lang = document.getElementById("language")?.value || "rw";
      const isRtl = lang === "ar";
      document.documentElement.lang = lang;
      document.body.style.direction = isRtl ? "rtl" : "ltr";
      const cardPreview = document.getElementById("cardPreview");
      const infoSection = document.getElementById("infoSection");
      if (cardPreview) cardPreview.classList.toggle("rtl", isRtl);
      if (infoSection) infoSection.classList.toggle("rtl", isRtl);
      const labels = ["cardTypeLabel", "orientationLabel", "colorModeLabel", "bgColorLabel", "textColorLabel", "fontLabel", "logoLabel", "fieldsContainerLabel"];
      labels.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.innerText = translations[lang][id.replace('Label', '')];
      });
      renderFields();
      updateQRInfo();
      updateWatermark();
    }

    // Update preview
    function updatePreview() {
      const type = document.getElementById("cardType")?.value || "business";
      const lang = document.getElementById("language")?.value || "rw";
      const card = document.getElementById("cardPreview");
      const orientation = document.getElementById("cardOrientation")?.value || "horizontal";
      if (!card) return;
      card.classList.toggle("vertical", orientation === "vertical");

      const infoSection = document.getElementById("infoSection");
      const logo = document.getElementById("logo");
      const companyName = document.getElementById("companyName");
      const contactDetails = document.getElementById("contactDetails");
      if (!infoSection || !logo || !companyName || !contactDetails) return;
      infoSection.innerHTML = "";
      logo.style.display = "none";

      const fields = translations[lang].fields[type];
      const fieldValues = fields.map(f => {
        const field = document.getElementById(`field_${f.replace(/\s+/g, '')}`);
        return field ? field.value || "" : "";
      });

      if (type === "business") {
        companyName.textContent = fieldValues[2];
        let detailsHTML = `
          <h2 id="displayMain">${fieldValues[0]}</h2>
          <p data-label="${translations[lang].fields.business[1]}">${fieldValues[1]}</p>
          <p data-label="${translations[lang].fields.business[3]}">${fieldValues[3]}</p>
          <p data-label="${translations[lang].fields.business[4]}">${fieldValues[4]}</p>
          <p data-label="${translations[lang].fields.business[5]}">${fieldValues[5]}</p>
          <p data-label="${translations[lang].fields.business[6]}">${fieldValues[6]}</p>
        `;
        contactDetails.innerHTML = detailsHTML;
        infoSection.appendChild(logo);
        infoSection.appendChild(companyName);
        infoSection.appendChild(contactDetails);
      } else if (type === "id") {
        let detailsHTML = `
          <h2 id="displayMain">${fieldValues[0]}</h2>
          <p data-label="${translations[lang].fields.id[1]}">${fieldValues[1]}</p>
          <p data-label="${translations[lang].fields.id[2]}">${fieldValues[2]}</p>
          <p data-label="${translations[lang].fields.id[3]}">${fieldValues[3]}</p>
        `;
        contactDetails.innerHTML = detailsHTML;
        infoSection.appendChild(contactDetails);
      } else if (type === "resume") {
        companyName.textContent = fieldValues[1];
        let detailsHTML = `
          <h2 id="displayMain">${fieldValues[0]}</h2>
          <p data-label="${translations[lang].fields.resume[2]}">${fieldValues[2]}</p>
          <p data-label="${translations[lang].fields.resume[3]}">${fieldValues[3]}</p>
          <p data-label="${translations[lang].fields.resume[4]}">${fieldValues[4]}</p>
          <p data-label="${translations[lang].fields.resume[5]}">${fieldValues[5]}</p>
        `;
        contactDetails.innerHTML = detailsHTML;
        infoSection.appendChild(logo);
        infoSection.appendChild(companyName);
        infoSection.appendChild(contactDetails);
      } else if (type === "photo") {
        let detailsHTML = `
          <h2 id="displayMain">${fieldValues[0]}</h2>
          <p data-label="${translations[lang].fields.photo[1]}">${fieldValues[1]}</p>
          <p data-label="${translations[lang].fields.photo[2]}">${fieldValues[2]}</p>
          <p data-label="${translations[lang].fields.photo[3]}">${fieldValues[3]}</p>
        `;
        contactDetails.innerHTML = detailsHTML;
        infoSection.appendChild(logo);
        infoSection.appendChild(contactDetails);
      } else if (type === "document") {
        let detailsHTML = `
          <h2 id="displayMain">${fieldValues[0]}</h2>
          <p data-label="${translations[lang].fields.document[1]}">${fieldValues[1]}</p>
          <p data-label="${translations[lang].fields.document[2]}">${fieldValues[2]}</p>
        `;
        contactDetails.innerHTML = detailsHTML;
        infoSection.appendChild(contactDetails);
      }

      if (document.getElementById("logoImg")?.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          logo.src = e.target.result;
          logo.style.display = "block";
        };
        reader.readAsDataURL(document.getElementById("logoImg").files[0]);
      }

      updateCardColor();
      updateTextColor();
      updateFontStyle();
      updateWatermark();
    }

    // Sidebar JavaScript
    const dashboard = document.getElementById('dashboard');
    const dashboardIcon = document.getElementById('dashboard-icon');
    const closeDashboard = document.getElementById('close-dashboard');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const logo = document.getElementById('logo');
    const scrollPositions = {};

    function saveScrollPosition() {
      scrollPositions[window.location.pathname] = window.scrollY || window.pageYOffset;
    }

    function restoreScrollPosition() {
      const scrollPosition = scrollPositions[window.location.pathname] || 0;
      window.scrollTo({ top: scrollPosition, behavior: 'auto' });
    }

    function toggleSidebar() {
      const isActive = dashboard.classList.toggle('active');
      sidebarOverlay.classList.toggle('active', isActive);
      document.body.classList.toggle('sidebar-active', isActive);
      document.body.classList.toggle('no-scroll', isActive);
      if (isActive) {
        saveScrollPosition();
        dashboard.scrollTop = 0;
      } else {
        restoreScrollPosition();
      }
    }

    // Card Builder Event Listeners
    document.getElementById("language").onchange = updateLanguage;
    document.getElementById("cardType").onchange = () => {
      renderFields();
      autoOrientation();
      updateQRInfo();
    };
    document.getElementById("colorMode").onchange = updateCardColor;
    document.getElementById("cardColor").oninput = updateCardColor;
    document.getElementById("textColor").oninput = updateTextColor;
    document.getElementById("fontStyle").onchange = updateFontStyle;
    document.getElementById("logoImg").onchange = function () {
      updatePreview();
    };
    document.getElementById("useGradient").onchange = function () {
      const gradientControls = document.getElementById("gradientControls");
      gradientControls.style.display = this.checked ? "block" : "none";
      updateCardColor();
    };
    document.getElementById("gradientColor1").oninput = updateCardColor;
    document.getElementById("gradientColor2").oninput = updateCardColor;
    document.getElementById("gradientDirection").onchange = updateCardColor;

    // Generate QR & Preview
    document.getElementById("generateBtn").onclick = async () => {
      const type = document.getElementById("cardType")?.value || "business";
      const lang = document.getElementById("language")?.value || "rw";
      const qrCode = document.getElementById("qrcode");
      if (!qrCode) return;

      const qrContainer = document.getElementById("qrContainer");
      if (qrContainer) {
        qrContainer.style.position = "absolute";
        qrContainer.style.bottom = "15px";
        qrContainer.style.right = "15px";
        qrContainer.style.width = "100px";
        qrContainer.style.height = "100px";
      }

      if (type === "business" || type === "resume") {
        const phone = document.getElementById(`field_${translations[lang].fields[type][3].replace(/\s+/g, '')}`)?.value || "";
        const website = document.getElementById(`field_${translations[lang].fields[type][5]?.replace(/\s+/g, '')}`)?.value || "";
        const vcard = `BEGIN:VCARD
VERSION:3.0
${phone ? `TEL:${phone}` : ""}
${website ? `URL:${website}` : ""}
END:VCARD`;
        currentSVG = await QRCode.toString(vcard, { type: 'svg', width: 100, color: { dark: "#000000", light: "#ffffff" } });
        qrCode.innerHTML = currentSVG;
        alert(translations[lang].qrInfo[type]);
      } else {
        qrCode.innerHTML = "";
        currentSVG = "";
        alert(translations[lang].qrInfo[type]);
      }
    };

    // Download PNG
    document.getElementById("downloadPNGBtn").onclick = async () => {
      const cardPreview = document.getElementById("cardPreview");
      if (!cardPreview) return;
      const type = document.getElementById("cardType")?.value || "business";
      const width = 350;
      const height = document.getElementById("cardOrientation")?.value === "vertical" ? 350 : 200;
      const scale = 4;

      const canvas = document.createElement("canvas");
      canvas.width = width * scale;
      canvas.height = height * scale;
      const ctx = canvas.getContext("2d");
      if (!ctx) return;

      // Draw background
      const useGradient = document.getElementById("useGradient")?.checked;
      if (useGradient) {
        const color1 = document.getElementById("gradientColor1")?.value || "#012f47";
        const color2 = document.getElementById("gradientColor2")?.value || "#002240";
        const direction = document.getElementById("gradientDirection")?.value || "to right";
        let gradient;
        if (direction === "to right") {
          gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
        } else if (direction === "to left") {
          gradient = ctx.createLinearGradient(canvas.width, 0, 0, 0);
        } else if (direction === "to bottom") {
          gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        } else if (direction === "to top") {
          gradient = ctx.createLinearGradient(0, canvas.height, 0, 0);
        } else {
          gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        }
        gradient.addColorStop(0, color1);
        gradient.addColorStop(1, color2);
        ctx.fillStyle = gradient;
      } else {
        const bgColor = document.getElementById("cardColor")?.value || "#012f47";
        ctx.fillStyle = bgColor;
      }
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw logo
      const logo = document.getElementById("logo");
      if (logo.src && logo.style.display !== "none") {
        const img = new Image();
        img.src = logo.src;
        await new Promise(resolve => { img.onload = resolve; });
        ctx.drawImage(img, 15 * scale, 15 * scale, 50 * scale, 50 * scale);
      }

      // Draw text
      const infoSection = document.getElementById("infoSection");
      const textColor = document.getElementById("textColor")?.value || "#d4af37";
      const font = document.getElementById("fontStyle")?.value || "Segoe UI";
      ctx.fillStyle = textColor;
      ctx.font = `bold ${18 * scale}px ${font}`;
      ctx.fillText(document.getElementById("companyName").textContent || "", 80 * scale, 30 * scale);
      ctx.font = `bold ${16 * scale}px ${font}`;
      ctx.fillText(document.getElementById("displayMain")?.textContent || "", 15 * scale, 60 * scale);
      ctx.font = `${12 * scale}px ${font}`;
      const details = document.getElementById("contactDetails").querySelectorAll("p");
      details.forEach((p, i) => {
        ctx.fillText(`${p.getAttribute("data-label")}: ${p.textContent}`, 15 * scale, (80 + i * 20) * scale);
      });

      // Draw watermark for ID and document
      const lang = document.getElementById("language")?.value || "rw";
      if (type === "id" || type === "document") {
        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(-30 * Math.PI / 180);
        ctx.font = `${50 * scale}px ${font}`;
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillText(translations[lang].watermark, -150 * scale, 0);
        ctx.restore();
      }

      // Draw QR code
      if (currentSVG && (type === "business" || type === "resume")) {
        const qrBlob = new Blob([currentSVG], { type: "image/svg+xml;charset=utf-8" });
        const qrURL = URL.createObjectURL(qrBlob);
        const qrImg = new Image();
        qrImg.src = qrURL;
        await new Promise(resolve => { qrImg.onload = resolve; });
        const qrSize = 100 * scale;
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(canvas.width - qrSize - (15 * scale), canvas.height - qrSize - (15 * scale), qrSize, qrSize);
        ctx.drawImage(qrImg, canvas.width - qrSize - (15 * scale), canvas.height - qrSize - (15 * scale), qrSize, qrSize);
        URL.revokeObjectURL(qrURL);
      }

      const pngUrl = canvas.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = pngUrl;
      a.download = "card_builder.png";
      a.click();
    };

    // Initialize Card Builder
    renderFields();
    updateLanguage();
    autoOrientation();
    updateQRInfo();

    // Sidebar Event Listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Update visitor count
      try {
        const visitorCount = document.getElementById('visitors-count');
        const baseCount = 1245;
        const randomIncrement = Math.floor(Math.random() * 10);
        if (visitorCount) {
          visitorCount.textContent = (baseCount + randomIncrement).toLocaleString();
        }
      } catch (error) {
        console.error('Error updating visitor count:', error);
      }

      // Highlight current page
      try {
        const currentPage = location.pathname.split('/').pop();
        document.querySelectorAll('.sidebar a').forEach(link => {
          if (link.getAttribute('href') === currentPage) {
            link.classList.add('active');
          }
        });
      } catch (error) {
        console.error('Error setting active navigation link:', error);
      }

      // Event Listeners
      if (dashboardIcon) {
        dashboardIcon.addEventListener('click', toggleSidebar);
        dashboardIcon.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            toggleSidebar();
          }
        });
      }

      if (closeDashboard) {
        closeDashboard.addEventListener('click', toggleSidebar);
        closeDashboard.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            toggleSidebar();
          }
        });
      }

      if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', toggleSidebar);
      }

      if (logo) {
        logo.addEventListener('click', () => {
          window.location.href = 'index.html';
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', () => {
          saveScrollPosition();
          dashboard.classList.remove('active');
          sidebarOverlay.classList.remove('active');
          document.body.classList.remove('sidebar-active');
          document.body.classList.remove('no-scroll');
          if (link.href && !link.href.includes('#')) {
            dashboard.addEventListener('transitionend', restoreScrollPosition, { once: true });
          } else {
            restoreScrollPosition();
          }
        });
      });

      document.addEventListener('mousedown', (event) => {
        if (dashboard.classList.contains('active') && !dashboard.contains(event.target) && !dashboardIcon.contains(event.target)) {
          toggleSidebar();
        }
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && dashboard.classList.contains('active')) {
          toggleSidebar();
        }
      });

      document.addEventListener('touchstart', (e) => {
        if (dashboard.classList.contains('active')) {
          touchStartX = e.changedTouches[0].screenX;
        }
      }, { passive: true });

      document.addEventListener('touchend', (e) => {
        if (dashboard.classList.contains('active')) {
          touchEndX = e.changedTouches[0].screenX;
          if (touchStartX - touchEndX > 50) {
            toggleSidebar();
          }
        }
      }, { passive: true });

      document.addEventListener('touchmove', (event) => {
        if (dashboard.classList.contains('active') && !dashboard.contains(event.target)) {
          event.preventDefault();
        }
      }, { passive: false });

      window.addEventListener('resize', () => {
        if (window.innerWidth > 768 && dashboard.classList.contains('active')) {
          dashboard.classList.remove('active');
          sidebarOverlay.classList.remove('active');
          document.body.classList.remove('sidebar-active');
          document.body.classList.remove('no-scroll');
          restoreScrollPosition();
        }
      });

      window.addEventListener('load', restoreScrollPosition);
      window.addEventListener('beforeunload', saveScrollPosition);

      document.querySelectorAll('a[href="#"]').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
        });
      });
    });
  </script>
</body>
</html>